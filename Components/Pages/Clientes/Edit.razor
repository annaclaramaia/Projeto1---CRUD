@page "/clientes/edit/{id:int}"
@using Microsoft.EntityFrameworkCore.Metadata.Conventions
@using Projeto1.Interfaces
@using System.Diagnostics
@rendermode InteractiveServer
@inject IClienteRepository _clienteRepository
@inject NavigationManager _navigationManager

<h3>Editar Clientes</h3>

<form>
    <div class="row">
        <div class="col-md-6">
            <label for="nome">Nome</label>
            <input type="text" id="nome" class="form-control" @bind-value="nome" />
        </div>

        <div class="col-md-6">
            <label for="email">Email</label>
            <input type="email" id="email" class="form-control" @bind-value="email" />
        </div>
        
        <div class="col-md-3">
            <label for="telefone">Telefone</label>
            <input type="text" id="telefone" class="form-control" @bind-value="telefone" />
        </div>

    </div>

    <div class="row mt-3">
        <div class="col-md-2">
            <button type="button" class="btn btn-primary" @onclick="Atualizar">
                Atualizar
            </button>
            <button type="button" class="btn btn-warning" @onclick="Voltar">
                Voltar
            </button>
        </div>
    </div>
</form>

<p>@mensagem</p>

@code {

    [Parameter]

    public int id {get; set;}
    private Cliente novoCliente = new();

    private string nome = string.Empty;
    private string email = string.Empty;
    private string telefone = string.Empty;
    private string mensagem = string.Empty;

    protected override async Task OnInitializedAsync(){
        
        var result = await _clienteRepository.ObterPorIdAsync(id);

        if(result != null){
            novoCliente = result;
        }

        nome = novoCliente.Nome!;
        email = novoCliente.Email!;
        telefone = novoCliente.Telefone!;
    }
    private async Task Atualizar(){

        if(string.IsNullOrEmpty(nome)){
            return;
        }

        if(string.IsNullOrEmpty(telefone)){
            telefone = "00-00000-0000";
        }

        mensagem = "salvando...";

        novoCliente.Nome = nome;
        novoCliente.Email = email;
        novoCliente.Telefone = telefone;

        await _clienteRepository.AtualizarAsync(novoCliente);

        mensagem = "Cliente salvo com sucesso!";

        _navigationManager.NavigateTo("/clientes");

    }

    private async Task Voltar(){
        _navigationManager.NavigateTo("/clientes");
    }

}

